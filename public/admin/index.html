<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理后台 - 全国高校游戏开发社团地图</title>
  <link rel="stylesheet" href="css/admin.css?v=1.0.2">
</head>
<body>
  <main class="admin-container">
    <section id="loginSection" class="card">
      <h1>管理后台登录</h1>
      <p class="description">请输入管理员账号和密码。如果忘记密码，请联系系统维护人员。</p>
      <form id="loginForm" class="form" novalidate>
        <label class="form-field">
          <span>用户名</span>
          <input type="text" id="username" name="username" autocomplete="username" required>
        </label>
        <label class="form-field">
          <span>密码</span>
          <input type="password" id="password" name="password" autocomplete="current-password" required>
        </label>
        <button type="submit" id="loginButton" class="primary-button">登录</button>
      </form>
      <div id="loginStatus" class="status-message" aria-live="polite"></div>
    </section>

    <section id="dashboard" class="card card--dashboard hidden" aria-hidden="true">
      <header class="dashboard-header">
        <div>
          <h1>管理后台</h1>
          <p>管理社团提交和已批准的社团数据。</p>
        </div>
        <div class="dashboard-header__actions">
          <span id="adminDisplay" class="admin-display"></span>
          <button id="logoutButton" class="secondary-button">退出登录</button>
        </div>
      </header>

      <!-- 标签页切换 -->
      <div class="tabs">
        <button class="tab-button active" data-tab="submissions">提交审核</button>
        <button class="tab-button" data-tab="clubs">社团管理</button>
        <button class="tab-button" data-tab="sync">数据同步</button>
      </div>

      <!-- 提交审核面板 -->
      <div id="submissionsPanel" class="tab-panel active">
        <div class="toolbar">
          <div class="toolbar__filters">
            <label>
              状态筛选
              <select id="statusFilter">
                <option value="pending">待审核</option>
                <option value="approved">已通过</option>
                <option value="rejected">已拒绝</option>
                <option value="all">全部</option>
              </select>
            </label>
            <label>
              排序
              <select id="sortSelect">
                <option value="newest">最新提交</option>
                <option value="oldest">最早提交</option>
              </select>
            </label>
          </div>
          <div class="toolbar__actions">
            <button id="refreshButton" class="secondary-button">立即刷新</button>
          </div>
        </div>

        <div id="listStatus" class="status-message" aria-live="polite"></div>

        <div class="table-container">
          <table aria-label="提交列表">
            <thead>
              <tr>
                <th scope="col">社团名称</th>
                <th scope="col">学校</th>
                <th scope="col">省份</th>
                <th scope="col">提交时间</th>
                <th scope="col">状态</th>
                <th scope="col">操作</th>
              </tr>
            </thead>
            <tbody id="submissionTableBody">
            </tbody>
          </table>
        </div>

        <div class="pagination" id="pagination"></div>
      </div>

      <!-- 社团管理面板 -->
      <div id="clubsPanel" class="tab-panel">
        <div class="toolbar">
          <div class="toolbar__filters">
            <label>
              搜索
              <input type="text" id="clubSearchInput" placeholder="搜索社团名称或学校...">
            </label>
          </div>
          <div class="toolbar__actions">
            <button id="refreshClubsButton" class="secondary-button">刷新列表</button>
          </div>
        </div>

        <div id="clubsListStatus" class="status-message" aria-live="polite"></div>

        <div class="table-container">
          <table aria-label="社团列表">
            <thead>
              <tr>
                <th scope="col">社团名称</th>
                <th scope="col">学校</th>
                <th scope="col">省份</th>
                <th scope="col">城市</th>
                <th scope="col">创建时间</th>
                <th scope="col">操作</th>
              </tr>
            </thead>
            <tbody id="clubsTableBody">
            </tbody>
          </table>
        </div>
      </div>

      <!-- 数据同步面板 -->
      <div id="syncPanel" class="tab-panel">
        <div class="sync-container">
          <div class="sync-header">
            <h2>数据库 ↔ JSON 文件同步</h2>
            <p class="sync-description">管理 MongoDB 数据库和 JSON 文件之间的数据同步</p>
          </div>

          <div id="messageContainer" class="status-message" aria-live="polite"></div>

          <div id="statsContainer" class="stats-grid hidden">
            <div class="stat-box">
              <h3>数据库中的社团</h3>
              <p id="dbCount" class="stat-number">--</p>
            </div>
            <div class="stat-box">
              <h3>JSON 文件中的社团</h3>
              <p id="jsonCount" class="stat-number">--</p>
            </div>
            <div class="stat-box">
              <h3>重复记录</h3>
              <p id="duplicateCount" class="stat-number">--</p>
            </div>
            <div class="stat-box">
              <h3>差异数量</h3>
              <p id="differenceCount" class="stat-number">--</p>
            </div>
          </div>

          <div class="sync-actions">
            <button id="compareBtn" class="primary-button">对比数据</button>
            <button id="migrateJsonToDbBtn" class="secondary-button">JSON → Database</button>
            <button id="mergeBtn" class="secondary-button">智能合并</button>
            <button id="replaceBtn" class="danger-button">完全替换</button>
          </div>

          <div id="comparisonContainer" class="comparison-container hidden">
            <h3>对比结果</h3>
            <div id="comparisonTabs" class="comparison-tabs">
              <button class="comp-tab-btn active" data-tab="only-db">仅在数据库</button>
              <button class="comp-tab-btn" data-tab="only-json">仅在 JSON</button>
              <button class="comp-tab-btn" data-tab="differences">有差异的记录</button>
              <button class="comp-tab-btn" data-tab="duplicates">重复记录</button>
            </div>
            <div id="comparisonContent" class="comparison-content"></div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <section id="detailModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="detailTitle">
    <div class="modal__backdrop" id="modalBackdrop"></div>
    <div class="modal__content">
      <header class="modal__header">
        <h2 id="detailTitle">提交详情</h2>
        <button id="closeModalButton" class="icon-button" aria-label="关闭详情">×</button>
      </header>
      <div class="modal__body" id="detailBody">
        <div class="detail-grid">
          <div>
            <h3>社团信息</h3>
            <dl id="clubInfo"></dl>
          </div>
          <div>
            <h3>提交元数据</h3>
            <dl id="metaInfo"></dl>
          </div>
        </div>
        <div id="duplicateInfo" class="duplicate-info hidden"></div>
      </div>
      <footer class="modal__footer" id="modalFooter"></footer>
    </div>
  </section>

  <template id="tableRowTemplate">
    <tr>
      <td data-field="name"></td>
      <td data-field="school"></td>
      <td data-field="province"></td>
      <td data-field="submittedAt"></td>
      <td data-field="status"></td>
      <td data-field="actions"></td>
    </tr>
  </template>

  <script type="module" src="js/submissions.js?v=1.0.2"></script>
  <script type="module" src="js/sync.js?v=1.0.2"></script>
</body>
</html>
